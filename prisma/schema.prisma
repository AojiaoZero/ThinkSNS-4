// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Define a MySQL data source.
datasource db {
  // Pinned the `provider` is MySQL driver.
  provider             = "mysql"
  // Use the `url` to connect to your MySQL database.
  url                  = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

// Generate a JsvaScript client.
generator client {
  provider        = "prisma-client-js"
  binaryTargets   = ["native"]
  previewFeatures = ["referentialIntegrity"]
}

/// Setting
model Setting {
  /// The Storage Box name.
  name String @db.VarChar(48)

  /// The Storage box item key.
  key String @db.VarChar(48)

  /// The Storage box item value.
  value Json @db.Json

  @@unique([name, key])
  @@index([name])
  @@index([key])
}

/// User account meta.
model User {
  /// The user's ID.
  id String @id @db.Char(64)

  /// The user's user name.
  name String? @unique @db.VarChar(48)

  /// The user's email.
  email String? @unique @db.VarChar(128)

  /// The user's mobile number.
  phone String? @unique @db.VarChar(15)

  /// The user's registered at.
  registeredAt DateTime @default(now())

  /// The user's access tokens.
  accessTokens AccessToken[]

  /// Profile
  profile UserProfile?
}

/// Access token.
model AccessToken {
  /// The access token's token.
  token String @id @db.VarChar(128)

  /// The access token's user ID.
  userId String @db.Char(64)

  /// The access token's created at.
  createdAt DateTime @default(now())

  /// The access token's expiry date.
  expiredAt DateTime

  /// The access token's refresh expiry date.
  refreshExpiredAt DateTime

  /// The access token owner.
  user User @relation(fields: [userId], references: [id])

  @@index([userId])
}

/// User profile
model UserProfile {
  /// The user's ID.
  userId String @id @db.Char(64)

  /// The user's display name.
  name String? @db.VarChar(48)

  /// User bio.
  bio String? @db.VarChar(128)

  /// User avatar.
  avatar String? @db.VarChar(128)

  /// User location.
  location String? @db.VarChar(128)

  /// User birthday.
  birthday DateTime? @db.Date

  /// User Gender.
  gender Gender @default(UNKNOWN)

  /// Owner user
  user User @relation(fields: [userId], references: [id])
}

/// Gender
enum Gender {
  UNKNOWN  @map("unknow")
  MAN      @map("man")
  WOMAN    @map("woman")
}
